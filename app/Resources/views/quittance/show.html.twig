{% extends '::base.html.twig' %}
{% block menu -%}
{% embed  '::visite/menu.html.twig' %}
{% block menu_quittance_actif %}active{% endblock %}
{% endembed %}
{% endblock %}
{% block menu_caisse_actif %}active{% endblock %}
{% block ariane -%}
    <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{{ path('homepage') }}">Accueil</a></li>
          <li class="breadcrumb-item"><a href="{{ path('visite_quittance') }}">Quittance</a></li>
          <li class="breadcrumb-item">Détail de la Quittance</li>
    </ol>
{% endblock %}
{% block pagetitle -%}VOIR UNE QUITTANCE{% endblock %}
{% block actions %}
    <label class="btn btn-outline-secondary"><a href="{{ path('visite_quittance') }}">LISTER</a></label>
    <label class="btn btn-outline-secondary"><a  href="#" onclick="printDiv('quittance')">IMPRIMER</a></label>
    <label class="btn btn-outline-secondary">
        {% if quittance.paye %}<a href="#" title="Rembourser" onclick="rembourser()">REMBOURSER</a>
        {% else %}<a onclick="return confirm('Veuiller confirmer l\'encaissement de la quittance N° {{quittance.numero}}');" href="{{ path('caisse_quittance_encaisser', { 'id': quittance.id }) }}">ENCAISSER</a>
        {% endif %}
    </label>
{% endblock %}
{% block body %}
    <div id='quittance'>
    <div style="margin:10px">
    <span style="font-weight: bolder">N&deg; {{ quittance.numero }} - {%if quittance.rembourse %}REMBOURSEE{% elseif quittance.paye %}PAYEE{% else %}NON PAYEE{% endif %}</span>
    <span style="margin-left:200px; font-weight:bolder;font-size:30px">QUITTANCE</span>
    <span style="margin-left:50px; font-weight: bolder">NIF 86100089D</span>
    <span style="float:right"><img src="{{ asset('images/mts.jpg', absolute=true) }}" /></span>
</div>
<div>
    
</div>
<table border="1" style="width:1050px;" cellpadding="0" cellspacing="0">
     <tbody>
         <tr>
             <td colspan="7" style="border:none; padding:5px">
                 <span style="font-weight: bold">CVT : {{libelle}}</span>
                <span style="margin-left:500px; font-weight:bold;">Type/Marque : {{ quittance.visite.vehicule.modele.libelle}}/{{quittance.visite.vehicule.modele.marque.libelle }}</span>
             </td>
         </tr>
            <tr>
                <td colspan="7" style="border:none; padding:5px">
                    <span style="font-weight: bold">Date : {% if quittance.dateCreation %}{{ quittance.dateCreation|date('Y-m-d') }}{% endif %}</span>
                    <span style="margin-left:500px; font-weight:bold;">Immatriculation : {{ quittance.visite.vehicule.immatriculation }}</span>
                </td>
            </tr>
            <tr>
                <th>Quantit&eacute;</th>
                <th>Prix Unitaire</th>
                <th>Prix total</th>
                <th>TVA 18%</th>
                <th>Droit de timbre</th>
                <th>Total TTC</th>
                <th>Caissier</th>
            </tr>
            <tr style="text-align: center">
                <td>1</td>
                <td>{{ quittance.montantVisite|number_format(0, ',', ' ') }}</td>
                <td>{{ quittance.montantVisite|number_format(0, ',', ' ') }}</td>
                <td>{{ quittance.tva|number_format(0, ',', ' ') }}</td>
                <td>{{ quittance.timbre|number_format(0, ',', ' ')}}</td>
                <td>{{ (quittance.montantVisite+quittance.tva+quittance.timbre)|round(0, 'ceil')  }}</td>
                <td>{{ quittance.creePar }}</td>
            </tr>
     </tbody>
</table>
    </div>        
    <div id="remboursement-modal" title="REMBOURSEMENT"></div>
{% endblock %}
{% block javascripts -%}
    <script type="text/javascript">
        function printDiv(DivIdToPrint) 
{

  var divToPrint=document.getElementById(DivIdToPrint);

  var newWin=window.open('','Print-Window');

  newWin.document.open();

  newWin.document.write('<html><body style="width:1050px;size:landscape;" onload="window.print()">'+divToPrint.innerHTML+'</body></html>');

  newWin.document.close();
  newWin.close();

}
        function rembourser(){
            var options = {
                modal: true,
                height:500,
                width:700,
                buttons: {
                    "Rembourser": function() {
                        $(location).attr('href', '{{ path('quittance_rembourser', { 'id': quittance.id }) }}')
                    },
                    Annuler: function() {
                        $( this ).dialog( "close" );
                    }
                }
            };
            $('#remboursement-modal').html("<img src='{{ asset('images/loader.gif') }}' />");
            $('#remboursement-modal').load('{{ path('quittance_remboursement_confirmer', { 'id': quittance.id }) }}').dialog(options).dialog('open');
        }
    </script>
    
{% endblock %}
