{% extends '::base.html.twig' %}

{% block ariane -%}<a href="{{ path('homepage') }}">Accueil</a> > <a href="{{ path('affaire_index') }}">Affaires</a> > Créer une affaire{% endblock %}
{% block pagetitle -%}CREER UNE AFFAIRE{% endblock %}
{% block menu_affaire_actif %}active{% endblock %}

{% block body -%}

    {{ form(form) }}
    
{% endblock %}

{% block retour %} 
    <a href="{{ path('affaire_index') }}">
        Retour à la liste
    </a>
{% endblock %}
  
{% block javascripts -%}
<script type="text/javascript">
        $(document).ready(function() {

             $( "#appbundle_affaire_searchclient" ).autocomplete({
                 source : function(requete, reponse){
                            $.ajax({
                                    url : '{{ path('clients_ajax') }}', 
                                    dataType : 'json',
                                    data : {
                                        search : $('#appbundle_affaire_searchclient').val(),
                                        maxRows : 15
                                    },
                                    success : function(donnee){
                                        reponse($.map(donnee, function(objet){
                                             return {
                                                 nom :objet.nom,
                                                 prenom : objet.prenom,
                                                 telephone : objet.telephone,
                                                 id : objet.id
                                             };
                                        }));
                                    }
                                });
                            },
                            select: function (event, ui) {
                                $( "#appbundle_affaire_searchclient" ).val( ui.item.prenom + ' '+ ui.item.nom + ' '+ ui.item.telephone );
                                $( "#appbundle_affaire_clientid" ).val( ui.item.id );
                                 return false;
                            }
              }).data('ui-autocomplete')._renderItem = function (ul, item) {
                            return $("<li />")
                                .data("item.autocomplete", item)
                                .append(item.prenom + ' '+ item.nom + ' '+ item.telephone + "</a>")
                                .appendTo(ul);
               };
               
               $( "#appbundle_affaire_searchbien" ).autocomplete({
                 source : function(requete, reponse){
                            $.ajax({
                                    url : '{{ path('biens_ajax') }}', 
                                    dataType : 'json',
                                    data : {
                                        search : $('#appbundle_affaire_searchbien').val(),
                                        maxRows : 15
                                    },
                                    success : function(donnee){
                                        reponse($.map(donnee, function(objet){
                                             return {
                                                 nom :objet.nom,
                                                 prenom : objet.prenom,
                                                 telephone : objet.telephone,
                                                 libelle : objet.libelle,
                                                 id : objet.id,
                                                 loyer : objet.loyer,
                                                 loyerj : objet.loyerJournalier,
                                                 montant : objet.montant,
                                             };
                                        }));
                                    }
                                });
                            },
                            select: function (event, ui) {
                                $( "#appbundle_affaire_searchbien" ).val( ui.item.libelle + ' '+ ui.item.prenom + ' '+ ui.item.nom + ' '+ ui.item.telephone );
                                $( "#appbundle_affaire_bienid" ).val( ui.item.id );
                                $( "#appbundle_affaire_loyerm" ).val( ui.item.loyer );
                                $( "#appbundle_affaire_loyerj" ).val( ui.item.loyerj );
                                $( "#appbundle_affaire_montantt" ).val( ui.item.montant );
                                 return false;
                            }
              }).data('ui-autocomplete')._renderItem = function (ul, item) {
                            return $("<li />")
                                .data("item.autocomplete", item)
                                .append(item.libelle + ' '+ item.prenom + ' '+ item.nom + ' '+ item.telephone + "</a>")
                                .appendTo(ul);
               };
            
               
               if($("#appbundle_affaire_type option:selected" ).text() === "VENTE"){
                   $( "#appbundle_affaire_typeLocation" ).val('CHOISIR UNE DUREE');
                    $( "#appbundle_affaire_typeLocation" ).prop('disabled', true);
                    $( "#appbundle_affaire_loyer" ).val(0);
                    $( "#appbundle_affaire_loyer" ).prop('readonly', "readonly");
                    $( "#appbundle_affaire_montant" ).prop('readonly', "");
                    $("#appbundle_affaire_caution").val(0);
              }else{
                  $( "#appbundle_affaire_typeLocation" ).prop('disabled', false);
                  $( "#appbundle_affaire_montant" ).val(0);
                  $( "#appbundle_affaire_loyer" ).prop('readonly', "");
                  $("#appbundle_affaire_caution").val(null);
              };
              
               $( "#appbundle_affaire_type" ).change(function() {
                if($( "#appbundle_affaire_type option:selected" ).text() === "VENTE"){
                    $( "#appbundle_affaire_typeLocation" ).val('CHOISIR UNE DUREE');
                   $( "#appbundle_affaire_typeLocation" ).prop('disabled', true);
                    $( "#appbundle_affaire_loyer" ).val(0);
                    $( "#appbundle_affaire_loyer" ).prop('readonly', "readonly");
                    $( "#appbundle_affaire_montant" ).prop('readonly', "");
                    $( "#appbundle_affaire_montant" ).val($( "#appbundle_affaire_montantt" ).val());
                    $("#appbundle_affaire_caution").val(0);
                }else{
                    if($( "#appbundle_affaire_typeLocation option:selected" ).text() === "JOURNALIERE"){
                        $( "#appbundle_affaire_typeLocation" ).prop('disabled', false);
                        $( "#appbundle_affaire_montant" ).val(0);
                        $( "#appbundle_affaire_montant" ).prop('readonly', "readonly");
                        $( "#appbundle_affaire_loyer" ).prop('readonly', "");
                        $( "#appbundle_affaire_loyer" ).val($( "#appbundle_affaire_loyerj" ).val());
                    }else{
                        $( "#appbundle_affaire_typeLocation" ).prop('disabled', false);
                        $( "#appbundle_affaire_montant" ).val(0);
                        $( "#appbundle_affaire_montant" ).prop('readonly', "readonly");
                        $( "#appbundle_affaire_loyer" ).prop('readonly', "");
                        $( "#appbundle_affaire_loyer" ).val($( "#appbundle_affaire_loyerm" ).val());
                    }
                    $("#appbundle_affaire_caution").val(null);
                   
                }
            });
            
               $( "#appbundle_affaire_typeLocation" ).change(function() {
                
                    if($( "#appbundle_affaire_typeLocation option:selected" ).text() === "JOURNALIERE"){
                        $( "#appbundle_affaire_loyer" ).val($( "#appbundle_affaire_loyerj" ).val());
                    }else if($( "#appbundle_affaire_typeLocation option:selected" ).text() === "LONGUE DUREE"){

                        $( "#appbundle_affaire_loyer" ).val($( "#appbundle_affaire_loyerm" ).val());
                    }else{

                        $( "#appbundle_affaire_loyer" ).val(0);
                    }
                   
                
            });
            
        } );
    </script>
{% endblock %}